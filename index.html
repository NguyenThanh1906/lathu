<!DOCTYPE html>
<html lang="vi">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Happy Birthday</title>

<link href="https://fonts.googleapis.com/css2?family=Allura&family=Poppins:wght@600;800&display=swap" rel="stylesheet">

<style>
html,body{
  margin:0;
  padding:0;
  background:#000;
  overflow:hidden;
  font-family:'Poppins',sans-serif;
}
.page{position:fixed;inset:0;display:none}
.page.active{display:block}
canvas{position:fixed;inset:0}

/* LETTER */
.letter-page{
  background:#fffaf7;
  overflow:auto;
}
.letter{
  max-width:900px;
  margin:60px auto;
  background:#fff;
  padding:60px;
  border-radius:30px;
  font-size:22px;
  line-height:2;
  color:#6b4b4b;
  box-shadow:0 30px 70px rgba(0,0,0,.15);
}
@media(max-width:600px){
  .letter{
    padding:35px;
    font-size:19px;
  }
}
</style>
</head>

<body>

<!-- FIRE + DRONE PAGE -->
<div class="page active" id="pageFire">
  <canvas id="stars"></canvas>
  <canvas id="fx"></canvas>
</div>

<!-- LETTER PAGE -->
<div class="page letter-page" id="pageLetter">
  <div class="letter">
    <!-- üî¥ D√ÅN NGUY√äN N·ªòI DUNG TH∆Ø C·ª¶A B·∫†N V√ÄO ƒê√ÇY ‚Äì KH√îNG S·ª¨A -->
  </div>
</div>

<script>
const stars = document.getElementById("stars");
const fx = document.getElementById("fx");
const stx = stars.getContext("2d");
const ftx = fx.getContext("2d");

function resize(){
  stars.width = fx.width = innerWidth;
  stars.height = fx.height = innerHeight;
}
resize();
addEventListener("resize", resize);

/* ===== STAR BACKGROUND (GI·ªêNG L√öC ƒê·∫¶U) ===== */
let starArr=[];
for(let i=0;i<260;i++){
  starArr.push({
    x:Math.random()*stars.width,
    y:Math.random()*stars.height,
    s:Math.random()*0.4+0.15
  });
}
function drawStars(){
  stx.fillStyle="rgba(0,0,0,0.4)";
  stx.fillRect(0,0,stars.width,stars.height);
  stx.fillStyle="#fff";
  starArr.forEach(s=>{
    s.y+=s.s;
    if(s.y>stars.height){ s.y=0; s.x=Math.random()*stars.width; }
    stx.fillRect(s.x,s.y,2,5);
  });
}

/* ===== DRONE TEXT ===== */
const texts=["3","2","1","HAPPY","BIRTHDAY","TRANG","HO√ÄNG","PH√öC","LOVE YOU ‚ù§Ô∏è"];
let idx=0, points=[], hold=0;
let isLove=false, fireDone=false;

function buildText(txt){
  points=[];
  const off=document.createElement("canvas");
  off.width=fx.width;
  off.height=fx.height;
  const o=off.getContext("2d");

  const isMobile = innerWidth < 768;
  const isNumber = /^[0-9]+$/.test(txt);

  let fontSize;
  if(isNumber){
    fontSize = isMobile ? fx.width*0.4 : fx.width*0.22;
  }else{
    fontSize = isMobile ? fx.width*0.26 : fx.width*0.18;
  }

  o.fillStyle="#fff";
  o.textAlign="center";
  o.textBaseline="middle";
  o.font=`800 ${fontSize}px Poppins`;
  o.fillText(txt,off.width/2,off.height/2);

  const img=o.getImageData(0,0,off.width,off.height).data;
  const step = isMobile ? 7 : 6; // üëâ tƒÉng m·∫≠t ƒë·ªô drone

  for(let y=0;y<off.height;y+=step){
    for(let x=0;x<off.width;x+=step){
      if(img[(y*off.width+x)*4+3]>200){
        points.push({
          x:Math.random()*fx.width,
          y:Math.random()*fx.height,
          tx:x, ty:y, vx:0, vy:0
        });
      }
    }
  }

  isLove = txt.includes("LOVE");
}

buildText(texts[0]);

setInterval(()=>{
  hold++;
  if(hold<36) return;
  hold=0;
  idx++;
  if(idx<texts.length){
    buildText(texts[idx]);
  }
},120);

function drawDrone(){
  ftx.clearRect(0,0,fx.width,fx.height);
  points.forEach(p=>{
    p.vx+=(p.tx-p.x)*0.03;
    p.vy+=(p.ty-p.y)*0.03;
    p.vx*=0.78;
    p.vy*=0.78;
    p.x+=p.vx;
    p.y+=p.vy;
    ftx.fillStyle="rgba(255,180,200,0.95)";
    ftx.fillRect(p.x,p.y,3,3);
  });
}

/* ===== FIREWORKS (CH·ªà LOVE YOU) ===== */
let fireworks=[];
function launchFirework(){
  const cx=Math.random()*fx.width;
  const cy=Math.random()*fx.height*0.6;
  const colors=["#ff9aa2","#ffd6a5","#caffbf","#bdb2ff","#ffc6ff"];
  for(let i=0;i<120;i++){
    const a=Math.random()*Math.PI*2;
    const s=Math.random()*3+1;
    fireworks.push({
      x:cx,y:cy,
      vx:Math.cos(a)*s,
      vy:Math.sin(a)*s,
      life:100,
      color:colors[Math.floor(Math.random()*colors.length)]
    });
  }
}
function drawFireworks(){
  if(isLove && Math.random()<0.08){
    launchFirework();
  }
  fireworks.forEach(p=>{
    p.x+=p.vx;
    p.y+=p.vy;
    p.vy+=0.03;
    p.life--;
    ftx.fillStyle=p.color;
    ftx.fillRect(p.x,p.y,2.2,2.2);
  });
  fireworks=fireworks.filter(p=>p.life>0);

  if(isLove && !fireDone && fireworks.length>400){
    fireDone=true;
    setTimeout(()=>{
      document.getElementById("pageFire").classList.remove("active");
      document.getElementById("pageLetter").classList.add("active");
    },1500);
  }
}

/* ===== LOOP ===== */
function loop(){
  drawStars();
  drawDrone();
  drawFireworks();
  requestAnimationFrame(loop);
}
loop();
</script>

</body>
</html>
